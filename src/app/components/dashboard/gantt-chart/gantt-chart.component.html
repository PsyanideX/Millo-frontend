<!-- Gantt Configuration Modal -->
@if (isConfigOpen()) {
<div class="modal-overlay" (mousedown)="handleOverlayMouseDown($event)" (click)="handleGanttConfigOverlayClick($event)">
    <div class="modal-content gantt-config-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Configurar Diagrama de Gantt</h2>
            <button class="close-btn" (click)="closeConfig()">&times;</button>
        </div>

        <div class="modal-body">
            <p class="config-description">Configura las horas de trabajo para cada día de la semana. Esta configuración
                se
                aplicará a todas las semanas del diagrama.</p>

            <div class="gantt-config-grid">
                @for (day of weekDays; track day.key) {
                <div class="day-config">
                    <label>{{ day.label }}</label>
                    <input type="number" [value]="workHours()[day.key]"
                        (input)="updateWorkHours(day.key, $any($event.target).valueAsNumber)" min="0" max="24"
                        step="0.5">
                    <span class="hours-label">horas</span>
                </div>
                }
            </div>

            <div class="total-hours-week">
                <strong>Total horas semanales:</strong> {{ getTotalWeeklyHours() }} horas
            </div>
        </div>

        <div class="modal-footer">
            <button class="cancel-btn" (click)="closeConfig()">Cancelar</button>
            <button class="submit-btn" (click)="generateGanttChart()">Generar Diagrama</button>
        </div>
    </div>
</div>
}

<!-- Gantt Chart Visualization Modal -->
@if (isChartOpen()) {
<div class="modal-overlay gantt-chart-overlay" (mousedown)="handleOverlayMouseDown($event)"
    (click)="handleGanttChartOverlayClick($event)">
    <div class="modal-content gantt-chart-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Diagrama de Gantt - {{ boardName() }}</h2>
            <button class="close-btn" (click)="closeChart()">&times;</button>
        </div>

        <div class="modal-body gantt-body">
            @if (ganttTasks().length > 0) {
            <div class="gantt-container" [style.--timeline-width.px]="ganttWeeks().length * 350">
                <!-- Timeline Header -->
                <div class="gantt-header">
                    <div class="gantt-task-column">
                        <div class="task-header-cell">Tarea</div>
                    </div>
                    <div class="gantt-timeline-column">
                        <div class="timeline-header">
                            @for (week of ganttWeeks(); track $index) {
                            <div class="week-header">
                                <span>Semana {{ $index + 1 }}</span>
                                <div class="days-header">
                                    @for (day of weekDays; track day.key) {
                                    <div class="day-header" [title]="day.label">
                                        {{ day.short }}
                                    </div>
                                    }
                                </div>
                            </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- Gantt Rows -->
                <div class="gantt-rows">
                    @for (ganttTask of ganttTasks(); track ganttTask.task.id) {
                    <div class="gantt-row">
                        <div class="gantt-task-info">
                            <div class="task-title">{{ ganttTask.task.title }}</div>
                            <div class="task-meta">
                                <span class="priority-badge" [class]="(ganttTask.task.priority || 'Low').toLowerCase()">
                                    {{ ganttTask.task.priority || 'Low' }}
                                </span>
                                <span class="effort-badge">{{ ganttTask.task.effortPoints || 0 }} h</span>
                                @if (ganttTask.task.category) {
                                <span class="category-badge" [style.background-color]="ganttTask.task.category.color">
                                    {{ ganttTask.task.category.name }}
                                </span>
                                }
                            </div>
                        </div>
                        <div class="gantt-timeline">
                            <div class="gantt-bar-container">
                                <div class="gantt-bar" [style.left.%]="ganttTask.startPercent"
                                    [style.width.%]="ganttTask.widthPercent"
                                    [class]="'priority-' + (ganttTask.task.priority || 'Low').toLowerCase()"
                                    [title]="'Inicio: Día ' + ganttTask.startDay + ' | Duración: ' + ganttTask.duration + ' días'">
                                    <span class="bar-label">{{ ganttTask.duration.toFixed(1) }} días</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    }
                </div>

                <!-- Summary -->
                <div class="gantt-summary">
                    <div class="summary-item">
                        <strong>Total de tareas:</strong> {{ ganttTasks().length }}
                    </div>
                    <div class="summary-item">
                        <strong>Esfuerzo total:</strong> {{ getTotalEffort() }} horas
                    </div>
                    <div class="summary-item">
                        <strong>Duración estimada:</strong> {{ ganttWeeks().length }} semana(s)
                    </div>
                </div>
            </div>
            } @else {
            <div class="no-tasks-message">
                <p>No hay tareas en este tablero para generar un diagrama de Gantt.</p>
            </div>
            }
        </div>

        <div class="modal-footer">
            <button class="cancel-btn" (click)="closeChart()">Cerrar</button>
        </div>
    </div>
</div>
}